<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S∆° ƒê·ªì Quy·ªÅn Con Ng∆∞·ªùi XHCN</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Quicksand', sans-serif;
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #fffde7;
            background-image: radial-gradient(#fff9c4 15%, transparent 16%), radial-gradient(#fff9c4 15%, transparent 16%);
            background-size: 60px 60px;
            background-position: 0 0, 30px 30px;
            color: #4e342e;
        }

        #container {
            width: 100vw;
            height: 100vh;
            cursor: grab;
            z-index: 10;
            position: relative;
        }
        #container:active { cursor: grabbing; }

        /* --- BACKGROUND ƒê·ªòNG --- */
        .bg-sticker-container {
            position: absolute; pointer-events: none; z-index: 0;
            animation: floatUp linear infinite;
        }
        @keyframes floatUp {
            0% { transform: translateY(110vh); opacity: 0; }
            10% { opacity: 0.6; }
            90% { opacity: 0.6; }
            100% { transform: translateY(-10vh); opacity: 0; }
        }
        .flag-wave { display: inline-block; transform-origin: bottom center; animation: wave 2s ease-in-out infinite alternate; }
        @keyframes wave { 0% { transform: rotate(-8deg) skewX(-2deg); } 100% { transform: rotate(8deg) skewX(2deg); } }
        .normal-sticker { display: inline-block; animation: spin 6s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* --- D3 STYLES --- */
        .link {
            fill: none;
            stroke: #ffcc80;
            stroke-width: 1.5px;
            stroke-dasharray: 4, 4; 
            transition: all 0.5s;
        }
        .node { cursor: pointer; }
        .node rect {
            fill: #ffffff;
            stroke: #ffab91;
            stroke-width: 2px;
            rx: 12; ry: 12;
            filter: drop-shadow(2px 3px 4px rgba(0,0,0,0.1));
            transition: all 0.3s ease;
        }
        .node:hover rect {
            stroke: #d84315;
            fill: #fff8e1;
            transform: scale(1.02);
        }
        .node circle.category-dot { stroke: #fff; stroke-width: 2px; }
        .node text {
            font-size: 11px;
            font-weight: 700;
            fill: #4e342e;
            pointer-events: none;
        }
        .node text.icon { font-size: 14px; }
        .node circle.badge {
            fill: #d32f2f;
            stroke: #fff;
            stroke-width: 1.5px;
            display: none; 
        }
        .node--collapsed circle.badge { display: block; } 

        /* B·∫£ng ch√∫ th√≠ch */
        .legend-panel {
            position: absolute; top: 20px; left: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px; border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border: 2px solid #ffcc80;
            max-width: 280px; z-index: 20;
            max-height: 85vh; overflow-y: auto;
        }
        .legend-panel h1 { margin: 0 0 10px 0; font-size: 16px; color: #bf360c; text-align: center; border-bottom: 2px dashed #ffcc80; padding-bottom: 10px; }
        .legend-item { display: flex; align-items: center; margin-bottom: 6px; font-size: 12px; color: #5d4037; font-weight: 600; }
        .color-dot { width: 10px; height: 10px; border-radius: 50%; margin-right: 8px; border: 2px solid #fff; box-shadow: 0 1px 3px rgba(0,0,0,0.2); }
        
        /* Tooltip Box Ri√™ng */
        #custom-tooltip {
            position: absolute;
            opacity: 0;
            background: #263238;
            color: #fff;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            pointer-events: none;
            max-width: 300px;
            z-index: 100;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            line-height: 1.4;
        }

        /* Source Footer */
        .source-footer {
            position: absolute;
            bottom: 10px;
            right: 20px;
            font-size: 11px;
            color: #8d6e63;
            font-style: italic;
            z-index: 20;
            background: rgba(255, 255, 255, 0.7);
            padding: 5px 10px;
            border-radius: 5px;
        }
    </style>
</head>
<body>

    <div id="bg-animation"></div>
    <div id="custom-tooltip"></div>

    <div class="legend-panel">
        <h1>üáªüá≥ B·∫£n ƒê·ªì Nh√¢n Quy·ªÅn</h1>
        <p style="text-align: center; font-size: 11px; color: #795548; margin-bottom: 10px;">
            M√¥ h√¨nh chi ti·∫øt & ph√¢n t·∫ßng
        </p>
        <div class="legend-item"><div class="color-dot" style="background:#d32f2f"></div>üìö 1. C∆° s·ªü L√Ω lu·∫≠n</div>
        <div class="legend-item"><div class="color-dot" style="background:#1976d2"></div>üó≥Ô∏è 2. Ch√≠nh tr·ªã - D√¢n ch·ªß</div>
        <div class="legend-item"><div class="color-dot" style="background:#00796b"></div>‚öñÔ∏è 3. D√¢n s·ª±</div>
        <div class="legend-item"><div class="color-dot" style="background:#fbc02d"></div>üí∞ 4. Kinh t·∫ø</div>
        <div class="legend-item"><div class="color-dot" style="background:#8e24aa"></div>üé® 5. VƒÉn h√≥a</div>
        <div class="legend-item"><div class="color-dot" style="background:#e64a19"></div>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ 6. X√£ h·ªôi</div>
        <p style="margin-top:10px; text-align:center; font-size:10px; color:#8d6e63; font-style:italic;">
            (B·∫•m üî¥ ƒë·ªÉ m·ªü r·ªông ‚Ä¢ R√™ chu·ªôt ƒë·ªÉ xem gi·∫£i nghƒ©a)
        </p>
    </div>

    

    <div id="container"></div>

    <script>
        // --- 1. D·ªÆ LI·ªÜU C√ÇY CHI TI·∫æT (FULL TEXT) ---
        const treeData = {
            "name": "QUY·ªÄN CON NG∆Ø·ªúI TRONG CNXH",
            "icon": "üáªüá≥",
            "color": "#3e2723",
            "children": [
                {
                    "name": "I. C∆° s·ªü L√Ω lu·∫≠n",
                    "icon": "üìö",
                    "color": "#d32f2f",
                    "children": [
                        { 
                            "name": "Ch·ªß nghƒ©a M√°c-L√™nin", 
                            "icon": "üìï", 
                            "children": [
                                { "name": "Gi·∫£i ph√≥ng con ng∆∞·ªùi", "icon": "üïäÔ∏è", "note": "M·ª•c ti√™u l√† x√≥a b·ªè √°p b·ª©c, b√≥c l·ªôt, ƒë·ªÉ con ng∆∞·ªùi ƒë∆∞·ª£c t·ª± do." },
                                { "name": "Ph√°t tri·ªÉn to√†n di·ªán", "icon": "üåü", "note": "Ph√°t tri·ªÉn c·∫£ v·ªÅ th·ªÉ ch·∫•t, tr√≠ tu·ªá, tinh th·∫ßn v√† ƒë·∫°o ƒë·ª©c." }
                            ]
                        }
                    ]
                },
                {
                    "name": "II. Quy·ªÅn Ch√≠nh tr·ªã",
                    "icon": "üó≥Ô∏è",
                    "color": "#1976d2",
                    "children": [
                        { 
                            "name": "B·∫ßu c·ª≠ & ·ª®ng c·ª≠", 
                            "icon": "üì©",
                            "children": [
                                { "name": "C∆° quan D√¢n c·ª≠", "icon": "üèõÔ∏è", "note": "G·ªìm Qu·ªëc h·ªôi (Trung ∆∞∆°ng) v√† H·ªôi ƒë·ªìng nh√¢n d√¢n (ƒê·ªãa ph∆∞∆°ng)." },
                                { "name": "Nguy√™n t·∫Øc b·∫ßu c·ª≠", "icon": "‚úÖ", "note": "Ph·ªï th√¥ng (ai c≈©ng ƒë∆∞·ª£c b·∫ßu), B√¨nh ƒë·∫≥ng (phi·∫øu ngang nhau), Tr·ª±c ti·∫øp, B·ªè phi·∫øu k√≠n." }
                            ]
                        },
                        { 
                            "name": "T·ª± do Ng√¥n lu·∫≠n", 
                            "icon": "üó£Ô∏è", 
                            "children": [
                                { "name": "T·ª± do B√°o ch√≠", "icon": "üì∞", "note": "Quy·ªÅn ƒë∆∞·ª£c s√°ng t·∫°o t√°c ph·∫©m b√°o ch√≠, ti·∫øp c·∫≠n th√¥ng tin ch√≠nh th·ªëng." },
                                { "name": "Ti·∫øp c·∫≠n th√¥ng tin", "icon": "üì°", "note": "ƒê∆∞·ª£c bi·∫øt c√°c th√¥ng tin v·ªÅ ho·∫°t ƒë·ªông c·ªßa nh√† n∆∞·ªõc (tr·ª´ b√≠ m·∫≠t qu·ªëc gia)." },
                                { "name": "H·ªôi h·ªçp & L·∫≠p h·ªôi", "icon": "üë•", "note": "Th·ª±c hi·ªán theo quy ƒë·ªãnh c·ªßa ph√°p lu·∫≠t ƒë·ªÉ ƒë·∫£m b·∫£o tr·∫≠t t·ª±." }
                            ]
                        },
                        { 
                            "name": "Tham gia Qu·∫£n l√Ω", 
                            "icon": "ü§ù", 
                            "children": [
                                { "name": "D√¢n ch·ªß tr·ª±c ti·∫øp", "icon": "üôã", "note": "D√¢n tr·ª±c ti·∫øp bi·ªÉu quy·∫øt c√°c v·∫•n ƒë·ªÅ tr·ªçng ƒë·∫°i (Tr∆∞ng c·∫ßu √Ω d√¢n)." },
                                { "name": "D√¢n ch·ªß ƒë·∫°i di·ªán", "icon": "üëî", "note": "Th√¥ng qua ƒë·∫°i bi·ªÉu Qu·ªëc h·ªôi v√† HƒêND c√°c c·∫•p." }
                            ]
                        }
                    ]
                },
                {
                    "name": "III. Quy·ªÅn D√¢n s·ª±",
                    "icon": "‚öñÔ∏è",
                    "color": "#00796b",
                    "children": [
                        { 
                            "name": "Quy·ªÅn S·ªëng", 
                            "icon": "‚ù§Ô∏è", 
                            "children": [
                                { "name": "B·∫£o h·ªô T√≠nh m·∫°ng", "icon": "üõ°Ô∏è", "note": "Ph√°p lu·∫≠t tr·ª´ng tr·ªã nghi√™m kh·∫Øc c√°c h√†nh vi x√¢m ph·∫°m t√≠nh m·∫°ng ng∆∞·ªùi kh√°c." },
                                { "name": "B·∫£o h·ªô Th√¢n th·ªÉ", "icon": "üëÆ", "note": "Kh√¥ng ai b·ªã b·∫Øt, giam gi·ªØ tr√°i lu·∫≠t; kh√¥ng b·ªã tra t·∫•n, nh·ª•c h√¨nh." }
                            ]
                        },
                        { 
                            "name": "T·ª± do T√≠n ng∆∞·ª°ng", 
                            "icon": "üôè", 
                            "children": [
                                { "name": "T·ª± do L·ª±a ch·ªçn", "icon": "‚õ™", "note": "Quy·ªÅn theo ho·∫∑c kh√¥ng theo t√¥n gi√°o n√†o. Kh√¥ng ai ƒë∆∞·ª£c √©p bu·ªôc." },
                                { "name": "B√¨nh ƒë·∫≥ng T√¥n gi√°o", "icon": "‚öñÔ∏è", "note": "C√°c t√¥n gi√°o ƒë·ªÅu b√¨nh ƒë·∫≥ng, ho·∫°t ƒë·ªông trong khu√¥n kh·ªï ph√°p lu·∫≠t." }
                            ]
                        },
                        { 
                            "name": "Quy·ªÅn Ri√™ng t∆∞", 
                            "icon": "üîí", 
                            "children": [
                                { "name": "B√≠ m·∫≠t Th∆∞ t√≠n", "icon": "‚úâÔ∏è", "note": "ƒêi·ªán tho·∫°i, th∆∞ t·ª´ l√† ri√™ng t∆∞, kh√¥ng ai ƒë∆∞·ª£c t·ª± √Ω xem/nghe tr·ªôm." },
                                { "name": "B·∫•t kh·∫£ x√¢m ph·∫°m ch·ªó ·ªü", "icon": "üè†", "note": "Kh√¥ng ai ƒë∆∞·ª£c t·ª± √Ω v√†o nh√† ng∆∞·ªùi kh√°c n·∫øu kh√¥ng c√≥ l·ªánh ho·∫∑c s·ª± ƒë·ªìng √Ω." }
                            ]
                        },
                        { 
                            "name": "ƒêi l·∫°i & C∆∞ tr√∫", 
                            "icon": "üö∂", 
                            "children": [
                                { "name": "T·ª± do ƒêi l·∫°i", "icon": "üõ£Ô∏è", "note": "ƒêi l·∫°i trong n∆∞·ªõc, ra n∆∞·ªõc ngo√†i v√† t·ª´ n∆∞·ªõc ngo√†i v·ªÅ n∆∞·ªõc." },
                                { "name": "T·ª± do C∆∞ tr√∫", "icon": "üèòÔ∏è", "note": "Quy·ªÅn ch·ªçn n∆°i sinh s·ªëng, ƒëƒÉng k√Ω th∆∞·ªùng tr√∫/t·∫°m tr√∫." }
                            ]
                        }
                    ]
                },
                {
                    "name": "IV. Quy·ªÅn Kinh t·∫ø",
                    "icon": "üí∞",
                    "color": "#fbc02d",
                    "children": [
                        { 
                            "name": "S·ªü h·ªØu T√†i s·∫£n", 
                            "icon": "üîë", 
                            "children": [
                                { "name": "T∆∞ li·ªáu Sinh ho·∫°t", "icon": "üè†", "note": "Nh√† ·ªü, xe c·ªô, ƒë·ªì d√πng c√° nh√¢n..." },
                                { "name": "T∆∞ li·ªáu S·∫£n xu·∫•t", "icon": "üè≠", "note": "V·ªën li·∫øng, m√°y m√≥c, nh√† x∆∞·ªüng ƒë·ªÉ kinh doanh." },
                                { "name": "Quy·ªÅn Th·ª´a k·∫ø", "icon": "üìù", "note": "Quy·ªÅn ƒë·ªÉ l·∫°i t√†i s·∫£n cho ng∆∞·ªùi kh√°c sau khi qua ƒë·ªùi." }
                            ]
                        },
                        { 
                            "name": "Lao ƒë·ªông & Vi·ªác l√†m", 
                            "icon": "üíº", 
                            "children": [
                                { "name": "T·ª± do ch·ªçn ngh·ªÅ", "icon": "üë∑", "note": "L√†m b·∫•t c·ª© ngh·ªÅ g√¨ ph√°p lu·∫≠t kh√¥ng c·∫•m." },
                                { "name": "L∆∞∆°ng c√¥ng b·∫±ng", "icon": "üíµ", "note": "Tr·∫£ l∆∞∆°ng theo nƒÉng su·∫•t, kh√¥ng th·∫•p h∆°n l∆∞∆°ng t·ªëi thi·ªÉu v√πng." },
                                { "name": "An to√†n lao ƒë·ªông", "icon": "‚õëÔ∏è", "note": "ƒê∆∞·ª£c trang b·ªã b·∫£o h·ªô, l√†m vi·ªác trong m√¥i tr∆∞·ªùng an to√†n." }
                            ]
                        },
                        { 
                            "name": "T·ª± do Kinh doanh", 
                            "icon": "üöÄ", 
                            "children": [
                                { "name": "M·ªçi ng√†nh ngh·ªÅ", "icon": "üè¢", "note": "Kinh doanh t·∫•t c·∫£ ng√†nh ngh·ªÅ m√† lu·∫≠t kh√¥ng c·∫•m." },
                                { "name": "C·∫°nh tranh l√†nh m·∫°nh", "icon": "ü§ù", "note": "Ch·ªëng ƒë·ªôc quy·ªÅn, gian l·∫≠n th∆∞∆°ng m·∫°i." }
                            ]
                        }
                    ]
                },
                {
                    "name": "V. Quy·ªÅn VƒÉn h√≥a",
                    "icon": "üé®",
                    "color": "#8e24aa",
                    "children": [
                        { 
                            "name": "Quy·ªÅn Gi√°o d·ª•c", 
                            "icon": "üéì", 
                            "children": [
                                { "name": "H·ªçc t·∫≠p su·ªët ƒë·ªùi", "icon": "üìö", "note": "Ai c≈©ng c√≥ quy·ªÅn ƒëi h·ªçc, kh√¥ng gi·ªõi h·∫°n ƒë·ªô tu·ªïi." },
                                { "name": "Ph·ªï c·∫≠p Ti·ªÉu h·ªçc", "icon": "üè´", "note": "Gi√°o d·ª•c ti·ªÉu h·ªçc l√† b·∫Øt bu·ªôc v√† mi·ªÖn h·ªçc ph√≠." },
                                { "name": "C∆° h·ªôi c√¥ng b·∫±ng", "icon": "‚öñÔ∏è", "note": "H·ªó tr·ª£ h·ªçc b·ªïng cho ng∆∞·ªùi ngh√®o, v√πng s√¢u v√πng xa." }
                            ]
                        },
                        { 
                            "name": "S√°ng t·∫°o VƒÉn h√≥a", 
                            "icon": "üî¨", 
                            "children": [
                                { "name": "Nghi√™n c·ª©u Khoa h·ªçc", "icon": "üß™", "note": "T·ª± do ph√°t minh, s√°ng ch·∫ø, c√¥ng b·ªë c√¥ng tr√¨nh." },
                                { "name": "S√°ng t√°c Ngh·ªá thu·∫≠t", "icon": "üñåÔ∏è", "note": "Vi·∫øt vƒÉn, l√†m th∆°, v·∫Ω tranh, l√†m phim..." }
                            ]
                        },
                        { 
                            "name": "H∆∞·ªüng th·ª• VƒÉn h√≥a", 
                            "icon": "üé≠", 
                            "children": [
                                { "name": "Ti·∫øp c·∫≠n Di s·∫£n", "icon": "üèõÔ∏è", "note": "Tham quan b·∫£o t√†ng, di t√≠ch, l·ªÖ h·ªôi." },
                                { "name": "S·ªü h·ªØu Tr√≠ tu·ªá", "icon": "¬ÆÔ∏è", "note": "B·∫£o v·ªá b·∫£n quy·ªÅn t√°c gi·∫£, kh√¥ng ai ƒë∆∞·ª£c sao ch√©p tr√°i ph√©p." }
                            ]
                        }
                    ]
                },
                {
                    "name": "VI. Quy·ªÅn X√£ h·ªôi",
                    "icon": "üë®‚Äçüë©‚Äçüëß‚Äçüë¶",
                    "color": "#e64a19",
                    "children": [
                        { 
                            "name": "An sinh X√£ h·ªôi", 
                            "icon": "‚òÇÔ∏è", 
                            "children": [
                                { "name": "B·∫£o hi·ªÉm X√£ h·ªôi", "icon": "üìë", "note": "L∆∞∆°ng h∆∞u, ch·∫ø ƒë·ªô thai s·∫£n, tai n·∫°n lao ƒë·ªông." },
                                { "name": "B·∫£o hi·ªÉm Th·∫•t nghi·ªáp", "icon": "üìâ", "note": "Tr·ª£ c·∫•p ti·ªÅn khi b·ªã m·∫•t vi·ªác l√†m." },
                                { "name": "B·∫£o tr·ª£ X√£ h·ªôi", "icon": "‚ôø", "note": "Nh√† n∆∞·ªõc nu√¥i d∆∞·ª°ng ng∆∞·ªùi gi√† neo ƒë∆°n, tr·∫ª m·ªì c√¥i." }
                            ]
                        },
                        { 
                            "name": "Y t·∫ø & S·ª©c kh·ªèe", 
                            "icon": "üè•", 
                            "children": [
                                { "name": "B·∫£o hi·ªÉm Y t·∫ø", "icon": "‚öïÔ∏è", "note": "Chi tr·∫£ vi·ªán ph√≠ khi ·ªëm ƒëau." },
                                { "name": "Ti√™m ch·ªßng m·ªü r·ªông", "icon": "üíâ", "note": "Tr·∫ª em ƒë∆∞·ª£c ti√™m v·∫Øc-xin mi·ªÖn ph√≠." }
                            ]
                        },
                        { 
                            "name": "H√¥n nh√¢n & Gia ƒë√¨nh", 
                            "icon": "üíç", 
                            "children": [
                                { "name": "T·ª± nguy·ªán", "icon": "‚ù§Ô∏è", "note": "K·∫øt h√¥n do nam n·ªØ t·ª± quy·∫øt ƒë·ªãnh, kh√¥ng √©p bu·ªôc." },
                                { "name": "B√¨nh ƒë·∫≥ng", "icon": "‚öñÔ∏è", "note": "V·ª£ ch·ªìng c√≥ quy·ªÅn ngang nhau trong gia ƒë√¨nh." }
                            ]
                        },
                        {
                            "name": "Nh√≥m Y·∫øu th·∫ø",
                            "icon": "üß∏",
                            "children": [
                                { "name": "B·∫£o v·ªá Tr·∫ª em", "icon": "üë∂", "note": "Ch·ªëng x√¢m h·∫°i, b·∫°o h√†nh tr·∫ª em." },
                                { "name": "Ph·ª• n·ªØ mang thai", "icon": "ü§∞", "note": "Ch·∫ø ƒë·ªô thai s·∫£n, chƒÉm s√≥c y t·∫ø, kh√¥ng b·ªã sa th·∫£i." },
                                { "name": "Ng∆∞·ªùi khuy·∫øt t·∫≠t", "icon": "ü¶Ω", "note": "H·ªó tr·ª£ vi·ªác l√†m, xe lƒÉn, l·ªëi ƒëi ri√™ng." },
                                { "name": "Ng∆∞·ªùi cao tu·ªïi", "icon": "üëµ", "note": "ƒê∆∞·ª£c chƒÉm s√≥c y t·∫ø, thƒÉm h·ªèi." }
                            ]
                        }
                    ]
                }
            ]
        };

        // --- 2. D3.JS SETUP & LOGIC ---
        const container = document.getElementById('container');
        const tooltip = document.getElementById('custom-tooltip');
        const width = container.clientWidth;
        const height = container.clientHeight;
        
        const svg = d3.select("#container").append("svg")
            .attr("width", "100%")
            .attr("height", "100%");

        const g = svg.append("g")
            .attr("transform", "translate(100,0)"); 

        svg.call(d3.zoom().scaleExtent([0.1, 4]).on("zoom", (event) => {
                g.attr("transform", event.transform);
            }))
            .on("dblclick.zoom", null);

        let i = 0;
        const duration = 500;
        let root;
        const tree = d3.tree().nodeSize([55, 260]); 

        root = d3.hierarchy(treeData, d => d.children);
        root.x0 = height / 2;
        root.y0 = 0;

        function inheritColors(node, parentColor) {
            if (!node.data.color && parentColor) node.data.color = parentColor;
            if (node.children) node.children.forEach(child => inheritColors(child, node.data.color));
        }
        inheritColors(root, root.data.color);

        // --- LOGIC THU G·ªåN ---
        function collapseAll(d) {
            if(d.children) {
                d.children.forEach(collapseAll); 
                d._children = d.children; 
                d.children = null; 
            }
        }
        if(root.children) {
            root.children.forEach(collapseAll);
        }

        update(root);

        // --- UPDATE FUNCTION ---
        function update(source) {
            const treeData = tree(root);
            const nodes = treeData.descendants();
            const links = treeData.links();

            nodes.forEach(d => { d.y = d.depth * 250; });

            const node = g.selectAll('g.node')
                .data(nodes, d => d.id || (d.id = ++i));

            const nodeEnter = node.enter().append('g')
                .attr('class', 'node')
                .attr("transform", d => `translate(${source.y0},${source.x0})`)
                .on('click', click)
                // --- CUSTOM TOOLTIP EVENT ---
                .on('mouseover', function(event, d) {
                    if (d.data.note) {
                        tooltip.style.opacity = 1;
                        tooltip.innerHTML = `<strong>${d.data.name}</strong><br/>üí° ${d.data.note}`;
                        tooltip.style.left = (event.pageX + 15) + 'px';
                        tooltip.style.top = (event.pageY - 28) + 'px';
                    }
                })
                .on('mouseout', function() {
                    tooltip.style.opacity = 0;
                });

            // Th·∫ª n·ªÅn
            nodeEnter.append('rect')
                .attr('width', 210)
                .attr('height', 42)
                .attr('x', -22)
                .attr('y', -21)
                .style("fill", "#fff")
                .style("stroke", d => d.data.color || "#ccc");

            // Ch·∫•m tr√≤n
            nodeEnter.append('circle')
                .attr('class', 'category-dot')
                .attr('r', 16)
                .attr('cx', -22)
                .attr('cy', 0)
                .style("fill", d => d.data.color || "#ccc");

            // Icon
            nodeEnter.append('text')
                .attr("class", "icon")
                .attr("x", -22)
                .attr("y", 5)
                .attr("text-anchor", "middle")
                .style("fill", "#fff")
                .text(d => d.data.icon || "‚Ä¢");

            // T√™n
            nodeEnter.append('text')
                .attr("x", 5)
                .attr("y", 4)
                .text(d => {
                    const maxLen = 30;
                    return d.data.name.length > maxLen ? d.data.name.substring(0, maxLen-2) + "..." : d.data.name;
                });

            // Badge ƒë·ªè
            nodeEnter.append('circle')
                .attr('class', 'badge')
                .attr('r', 5)
                .attr('cx', 188)
                .attr('cy', 0);

            const nodeUpdate = node.merge(nodeEnter);

            nodeUpdate.transition()
                .duration(duration)
                .attr("transform", d => `translate(${d.y},${d.x})`);

            nodeUpdate.select('rect')
                .style("stroke", d => d.data.color || "#ccc");

            nodeUpdate.classed('node--collapsed', d => d._children && d._children.length > 0);

            const nodeExit = node.exit().transition()
                .duration(duration)
                .attr("transform", d => `translate(${source.y},${source.x})`)
                .remove();

            nodeExit.select('rect').attr('width', 0);
            nodeExit.select('text').style('opacity', 0);

            const link = g.selectAll('path.link')
                .data(links, d => d.target.id);

            const linkEnter = link.enter().insert('path', "g")
                .attr("class", "link")
                .attr('d', d => {
                    const o = {x: source.x0, y: source.y0};
                    return diagonal(o, o);
                })
                .style("stroke", d => d.target.data.color || "#ccc");

            const linkUpdate = link.merge(linkEnter);
            linkUpdate.transition().duration(duration).attr('d', d => diagonal(d.source, d.target));
            
            const linkExit = link.exit().transition().duration(duration)
                .attr('d', d => {
                    const o = {x: source.x, y: source.y};
                    return diagonal(o, o);
                }).remove();

            nodes.forEach(d => { d.x0 = d.x; d.y0 = d.y; });

            function diagonal(s, d) {
                const startX = s.y + 188;
                const endX = d.y - 22;
                return `M ${startX} ${s.x}
                        C ${(startX + endX) / 2} ${s.x},
                          ${(startX + endX) / 2} ${d.x},
                          ${endX} ${d.x}`;
            }

            function click(event, d) {
                if (d.children) {
                    d._children = d.children;
                    d.children = null;
                } else {
                    d.children = d._children;
                    d._children = null;
                }
                update(d);
            }
        }
        
        // --- STICKER EFFECT ---
        const bgContainer = document.getElementById('bg-animation');
        const stickers = [
            { text: 'üáªüá≥', type: 'flag' }, { text: '‚öñÔ∏è', type: 'normal' }, 
            { text: '‚ù§Ô∏è', type: 'normal' }, { text: '‚≠ê', type: 'normal' }, 
            { text: 'üïäÔ∏è', type: 'normal' }, { text: 'üìö', type: 'normal' }
        ];
        function createSticker() {
            const container = document.createElement('div');
            container.classList.add('bg-sticker-container');
            const item = stickers[Math.floor(Math.random() * stickers.length)];
            const content = document.createElement('span');
            content.innerText = item.text;
            if (item.type === 'flag') {
                content.classList.add('flag-wave');
                container.style.fontSize = (Math.random() * 20 + 25) + 'px';
            } else {
                content.classList.add('normal-sticker');
                container.style.fontSize = (Math.random() * 15 + 15) + 'px';
            }
            container.appendChild(content);
            container.style.left = Math.random() * 100 + 'vw';
            container.style.animationDuration = (Math.random() * 10 + 20) + 's';
            bgContainer.appendChild(container);
            setTimeout(() => { container.remove(); }, 30000);
        }
        setInterval(createSticker, 1500);
    </script>
</body>
</html>